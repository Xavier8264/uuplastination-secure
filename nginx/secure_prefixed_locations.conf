## Use these location blocks when serving the app under /secure/
## Include inside your server { } block AFTER the main /secure/ location.

# Proxy WebRTC signaling under /secure/livekit/ â†’ LiveKit (127.0.0.1:7880)
location /secure/livekit/ {
    proxy_pass http://127.0.0.1:7880/;  # trailing slash strips /secure/livekit prefix
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_read_timeout 3600s;
    proxy_send_timeout 3600s;
}

# MJPEG camera endpoints under /secure/camera/
location ^~ /secure/camera/ {
    proxy_pass http://127.0.0.1:8000/camera/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_buffering off;
    proxy_cache off;
    chunked_transfer_encoding off;
    proxy_read_timeout 30s;
}

# API endpoints under /secure/api/
location ^~ /secure/api/ {
    proxy_pass http://127.0.0.1:8000/api/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 10s;
}

# WebRTC token/config under /secure/webrtc/
location ^~ /secure/webrtc/ {
    proxy_pass http://127.0.0.1:8000/webrtc/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 10s;
}
